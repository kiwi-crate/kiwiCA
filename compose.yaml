name: ca-crate

services:
  ca-crate:
    container_name: ${COMPOSE_PROJECT_NAME}
    entrypoint:
      - /bin/sh
      - /root/init.sh
    env_file: .env.${STAGE}
    environment:
      CA_GENERATE: ${CA_GENERATE}
    hostname: ${COMPOSE_PROJECT_NAME}${FQDN}
    image: ${COMPOSE_PROJECT_NAME}:${STAGE}
    restart: ${CONTAINER_RESTART_POLICY:-unless-stopped}
    volumes:
      - type: volume
        source: data
        target: /opt/ca-crate
      - type: bind
        source: ${ROOTCA_BIND_LOCATION:-./dummy}
        target: /opt/ca-crate/rootCA

volumes:
  data:
    name: ${COMPOSE_PROJECT_NAME}_data
